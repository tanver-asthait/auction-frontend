<div class="team-owner-dashboard">
  <!-- Team Not Found Error -->
  @if (teamNotFound()) {
    <div class="error-container">
      <h1>‚ùå Team Not Found</h1>
      <p>The team ID provided in the URL could not be found.</p>
      <p>Please check the URL and try again.</p>
      <p class="example">Example: <code>/team-owner/your-team-id</code></p>
    </div>
  } @else {
    
    <!-- Sticky Team Navigation Header -->
    <header class="team-header">
      <div class="header-content">
        <div class="team-info">
          <h1 class="team-name">
            <span class="icon">üèÜ</span>
            {{ teamName() }}
          </h1>
          <div class="team-details">
            <div class="budget-display">
              <span class="label">Available Budget:</span>
              <span class="amount">${{ budget() }}</span>
            </div>
            @if (canBid()) {
              <div class="next-bid-info">
                <span class="label">After Next Bid:</span>
                <span class="amount">${{ remainingBudget() }}</span>
              </div>
            }
          </div>
        </div>
        <div class="header-status">
          <div class="connection-indicator" [class.connected]="wsService.connected()" [class.disconnected]="!wsService.connected()">
            <span class="status-dot"></span>
            {{ wsService.connected() ? 'LIVE' : 'OFFLINE' }}
          </div>
          <div class="auction-status-badge" [class.active]="isRunning()">
            {{ isRunning() ? 'AUCTION LIVE' : 'WAITING' }}
          </div>
        </div>
      </div>
    </header>

    <!-- Main Dashboard Content -->
    <div class="dashboard-content">
      
      <!-- Last Sold Player Info -->
      @if (lastSoldInfo()) {
        <div class="dashboard-card last-sold-card">
          <div class="card-header">
            <h3>üí∞ Last Transaction</h3>
          </div>
          <div class="transaction-info">
            {{ lastSoldInfo() }}
          </div>
        </div>
      }

      <!-- Dashboard Grid -->
      <div class="dashboard-grid">
        
        <!-- Current Player Card -->
        <div class="dashboard-card current-player-card">
          <div class="card-header">
            <h3>üéØ Current Player</h3>
          </div>
          @if (currentPlayer()) {
            <div class="player-info">
              <div class="player-image">
                @if (currentPlayer()?.image) {
                  <img [src]="currentPlayer()!.image" [alt]="currentPlayer()!.name" />
                } @else {
                  <div class="player-placeholder">
                    <span class="placeholder-icon">üë§</span>
                  </div>
                }
              </div>
              <div class="player-details">
                <h4 class="player-name">{{ currentPlayer()!.name }}</h4>
                <div class="player-positions">
                  <span *ngFor="let pos of getPositionArray(currentPlayer()!.position)" 
                        class="position-badge" 
                        [class]="'position-' + pos.toLowerCase().replace(' ', '-')">
                    {{ pos }}
                  </span>
                </div>
                <div class="price-info">
                  <div class="base-price">Base: ${{ currentPlayer()!.basePrice }}</div>
                  <div class="status">Status: {{ currentPlayer()!.status }}</div>
                </div>
              </div>
            </div>
          } @else {
            <div class="no-player">
              <div class="no-player-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
              <p>No player is currently being auctioned</p>
            </div>
          }
        </div>

        <!-- Bidding Card -->
        <div class="dashboard-card bidding-card" [class.can-bid]="canBid()">
          <div class="card-header">
            <h3>üí∞ Current Bidding</h3>
          </div>
          <div class="bidding-content">
            <div class="bid-info">
              <div class="highest-bid">
                <span class="label">Highest Bid:</span>
                <span class="amount">${{ highestBid() }}</span>
              </div>
              <div class="highest-bidder">
                <span class="label">Highest Bidder:</span>
                @if (isHighestBidder()) {
                  <span class="you-badge">YOU</span>
                } @else {
                  <span class="bidder-name">{{ highestBidder() }}</span>
                }
              </div>
            </div>
            
            <!-- Bid Controls -->
            <div class="bid-controls">
              @if (canBid()) {
                <div class="next-bid-info">
                  <div class="bid-increment-display">
                    Base Increment: ${{ bidIncrement() }}
                  </div>
                </div>
                
                <!-- Multiple Increment Buttons -->
                <div class="bid-buttons-grid">
                  @for (multiplier of incrementMultipliers; track multiplier) {
                    <div class="bid-option">
                      <div class="bid-amount">
                        ${{ getBidAmountForMultiplier(multiplier) }}
                      </div>
                      <button 
                        class="bid-btn"
                        [class.affordable]="canBidWithMultiplier(multiplier)"
                        [class.too-expensive]="!canBidWithMultiplier(multiplier)"
                        [disabled]="!canBidWithMultiplier(multiplier)"
                        (click)="placeBid(multiplier)">
                        <span class="btn-icon">üî•</span>
                        <span class="increment-label">+{{ multiplier }}x</span>
                        <span class="increment-amount">${{ bidIncrement() * multiplier }}</span>
                      </button>
                    </div>
                  }
                </div>
                
                <!-- Remaining Budget Info -->
                <div class="budget-preview">
                  <span class="budget-label">After minimum bid:</span>
                  <span class="budget-amount">${{ budget() - nextBidAmount() }}</span>
                </div>
              } @else {
                <div class="bid-disabled-info">
                  @if (!wsService.connected()) {
                    <p class="reason">‚ùå Disconnected from server</p>
                  } @else if (!isRunning()) {
                    <p class="reason">‚è∏Ô∏è Auction not running</p>
                  } @else if (isHighestBidder()) {
                    <p class="reason">‚úÖ You are the highest bidder</p>
                  } @else if (nextBidAmount() > budget()) {
                    <p class="reason">üí∏ Insufficient budget</p>
                  } @else if (timer() <= 0) {
                    <p class="reason">‚è∞ Timer expired</p>
                  }
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Debug Information -->
      <!-- <details class="debug-section">
        <summary><strong>Debug Information</strong> (click to expand)</summary>
        <div class="debug-content">
          <h4>Current State:</h4>
          <ul>
            <li><strong>Team ID:</strong> {{ teamId() }}</li>
            <li><strong>WebSocket Connected:</strong> {{ wsService.connected() ? 'Yes' : 'No' }}</li>
            <li><strong>Auction Running:</strong> {{ isRunning() ? 'Yes' : 'No' }}</li>
            <li><strong>Timer:</strong> {{ timer() }}s</li>
            <li><strong>Current Player Exists:</strong> {{ currentPlayer() ? 'Yes' : 'No' }}</li>
            @if (currentPlayer()) {
              <li><strong>Current Player ID:</strong> {{ currentPlayer()?._id || 'N/A' }}</li>
              <li><strong>Current Player Name:</strong> {{ currentPlayer()?.name || 'N/A' }}</li>
            }
            <li><strong>Highest Bid:</strong> ${{ highestBid() }}</li>
            <li><strong>Highest Bidder:</strong> {{ highestBidder() }}</li>
            <li><strong>Is Highest Bidder:</strong> {{ isHighestBidder() ? 'Yes' : 'No' }}</li>
            <li><strong>Can Bid:</strong> {{ canBid() ? 'Yes' : 'No' }}</li>
            <li><strong>Budget:</strong> ${{ budget() }}</li>
            <li><strong>Next Bid Amount:</strong> ${{ nextBidAmount() }}</li>
          </ul>
          
          <h4>Troubleshooting:</h4>
          @if (!wsService.connected()) {
            <p style="color: red;">‚ùå <strong>Not connected to server</strong> - Refresh page or check server status</p>
          }
          @if (!currentPlayer()) {
            <p style="color: orange;">‚ö†Ô∏è <strong>No current player</strong> - Admin needs to start an auction</p>
          }
          @if (!isRunning()) {
            <p style="color: orange;">‚ö†Ô∏è <strong>Auction not running</strong> - Admin needs to start the auction</p>
          }
          @if (timer() <= 0) {
            <p style="color: red;">‚è±Ô∏è <strong>Timer expired</strong> - Waiting for next player</p>
          }
          
          <div style="margin-top: 15px;">
            <button 
              (click)="requestCurrentState()" 
              [disabled]="!wsService.connected()"
              style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
              Request Current State
            </button>
          </div>
        </div>
      </details> -->
    </div>
  }

  <!-- Team Players Section -->
  <div class="team-players-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="section-icon">üèÜ</span>
        My Team Players
      </h3>
      <div class="players-count">
        {{ playersByTeam().length }} Players
      </div>
    </div>

    <div class="players-table-container">
      @if (playersByTeam().length > 0) {
        <div class="players-table">
          <div class="table-header">
            <div class="header-cell image-cell">Photo</div>
            <div class="header-cell name-cell">Name</div>
            <div class="header-cell position-cell">Position</div>
            <div class="header-cell price-cell">Purchase Price</div>
            <div class="header-cell status-cell">Status</div>
          </div>
          
          <div class="table-body">
            @for (player of playersByTeam(); track player._id) {
              <div class="table-row" 
                   [class.current-auction]="currentPlayer()?._id === player._id">
                <div class="table-cell image-cell">
                  <div class="player-avatar">
                    @if (player.image) {
                      <img [src]="player.image" [alt]="player.name" />
                    } @else {
                      <div class="avatar-placeholder">
                        {{ player.name.charAt(0).toUpperCase() }}
                      </div>
                    }
                  </div>
                </div>
                
                <div class="table-cell name-cell">
                  <div class="player-name">{{ player.name }}</div>
                </div>
                
                <div class="table-cell position-cell">
                  <div class="positions-wrapper">
                    @for (position of getPositionArray(player.position); track position) {
                      <span class="position-tag" 
                            [class]="'position-' + position.toLowerCase().replace(' ', '-')">
                        {{ position }}
                      </span>
                    }
                  </div>
                </div>
                
                <div class="table-cell price-cell">
                  <div class="price-display">
                    <span class="price-amount">${{ player.finalPrice || player.basePrice }}</span>
                    @if (player.finalPrice && player.finalPrice > player.basePrice) {
                      <span class="price-increase">
                        +${{ player.finalPrice - player.basePrice }}
                      </span>
                    }
                  </div>
                </div>
                
                <div class="table-cell status-cell">
                  <span class="status-badge" [class]="'status-' + player.status.toLowerCase()">
                    {{ player.status }}
                  </span>
                  @if (currentPlayer()?._id === player._id) {
                    <span class="live-indicator">LIVE</span>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      } @else {
        <div class="no-players">
          <div class="no-players-icon">üë•</div>
          <h4>No Players Yet</h4>
          <p>Your team hasn't acquired any players yet. Start bidding in the auction to build your squad!</p>
        </div>
      }
    </div>
  </div>
</div>
